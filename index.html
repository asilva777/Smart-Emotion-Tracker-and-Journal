<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Emotional Wellness Tracker</title>
  <link rel="manifest" href="manifest.json">
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      margin: 0;
      background: #f5f5f5;
      color: #222;
    }
    .container {
      max-width: 500px;
      margin: 0 auto;
      padding: 1em;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1, h2 {
      text-align: center;
      font-weight: 600;
    }
    .emotion-wheel {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      margin: 1em 0;
    }
    .emotion-btn {
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      margin: 0.5em;
      color: #fff;
      font-size: 1em;
      font-weight: bold;
      cursor: pointer;
      outline: none;
      transition: transform 0.1s;
    }
    .emotion-btn.selected {
      border: 3px solid #444;
      transform: scale(1.15);
    }
    .add-emotion {
      display: flex;
      justify-content: center;
      margin: 1em 0;
      gap: 0.5em;
      flex-wrap: wrap;
    }
    .add-emotion input, .add-emotion button {
      font-size: 1em;
      padding: 0.3em 0.6em;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .add-emotion button {
      background: #0077cc;
      color: #fff;
      border: none;
      cursor: pointer;
    }
    #saveEmotion {
      display: block;
      width: 100%;
      margin: 1em 0;
      padding: 0.75em;
      background: #28a745;
      color: #fff;
      border: none;
      border-radius: 6px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
    }
    #emotionBarChart {
      background: #fff;
      border-radius: 8px;
      margin: 1em 0;
      width: 100% !important;
      height: 300px !important;
    }
    @media (max-width: 600px) {
      .container { max-width: 100%; border-radius: 0; }
      .emotion-btn { width: 40px; height: 40px; font-size: 0.9em; }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Emotional Wellness Tracker</h1>
    <h2>How are you feeling today?</h2>
    <div class="emotion-wheel" id="emotionWheel"></div>

    <div class="add-emotion">
      <input type="text" id="newEmotionName" placeholder="New emotion (e.g. Grateful)">
      <input type="color" id="newEmotionColor" value="#888888">
      <button onclick="addEmotion()">Add Emotion</button>
    </div>
    
    <button id="saveEmotion" disabled>Save Emotion</button>
    
    <canvas id="emotionBarChart"></canvas>

    <h2>My Entries</h2>
    <ul id="emotionList"></ul>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // --- Emotions Data: Default + Load from localStorage ---
    const defaultEmotions = [
      { name: 'Happy', color: '#FFD700' },
      { name: 'Sad', color: '#1E90FF' },
      { name: 'Angry', color: '#FF6347' },
      { name: 'Calm', color: '#32CD32' },
      { name: 'Anxious', color: '#FFB347' },
      { name: 'Excited', color: '#E67E22' },
      { name: 'Tired', color: '#A9A9A9' },
      { name: 'Surprised', color: '#8e44ad' }
    ];

    function loadEmotions() {
      return JSON.parse(localStorage.getItem('emotionsList')) || defaultEmotions;
    }
    function saveEmotions(emotions) {
      localStorage.setItem('emotionsList', JSON.stringify(emotions));
    }

    // --- Render Emotion Wheel ---
    function renderEmotionWheel(selected) {
      const emotions = loadEmotions();
      const wheel = document.getElementById('emotionWheel');
      wheel.innerHTML = '';
      emotions.forEach(e => {
        const btn = document.createElement('button');
        btn.className = 'emotion-btn';
        btn.style.background = e.color;
        btn.textContent = e.name;
        btn.onclick = () => selectEmotion(e.name);
        if (selected === e.name) btn.classList.add('selected');
        wheel.appendChild(btn);
      });
    }

    // --- Add New Emotion ---
    function addEmotion() {
      const nameInput = document.getElementById('newEmotionName');
      const colorInput = document.getElementById('newEmotionColor');
      const name = nameInput.value.trim();
      const color = colorInput.value;
      if (!name) { alert('Enter an emotion name.'); return; }
      let emotions = loadEmotions();
      if (emotions.some(e => e.name.toLowerCase() === name.toLowerCase())) {
        alert('Emotion already exists.');
        return;
      }
      emotions.push({ name, color });
      saveEmotions(emotions);
      renderEmotionWheel();
      nameInput.value = '';
      colorInput.value = '#888888';
    }

    // --- Emotion Selection ---
    let selectedEmotion = null;
    function selectEmotion(name) {
      selectedEmotion = name;
      renderEmotionWheel(selectedEmotion);
      document.getElementById('saveEmotion').disabled = false;
    }

    // --- Save Emotion Entry ---
    document.getElementById('saveEmotion').onclick = function() {
      if (!selectedEmotion) return;
      const today = new Date().toISOString().split('T')[0];
      const entry = { date: today, emotion: selectedEmotion };
      let emotions = JSON.parse(localStorage.getItem('emotions')) || [];
      emotions.push(entry);
      localStorage.setItem('emotions', JSON.stringify(emotions));
      renderEntries();
      renderBarChart();
      document.getElementById('saveEmotion').disabled = true;
      selectedEmotion = null;
      renderEmotionWheel();
    };

    // --- Get Emotion Color ---
    function getEmotionColor(emotion) {
      const emotions = loadEmotions();
      const found = emotions.find(e => e.name === emotion);
      return found ? found.color : '#888';
    }

    // --- Prepare Chart Data ---
    function getEmotionData() {
      const emotions = JSON.parse(localStorage.getItem('emotions')) || [];
      // Group by date and count each emotion
      const emotionCounts = {};
      emotions.forEach(entry => {
        if (!emotionCounts[entry.date]) emotionCounts[entry.date] = {};
        if (!emotionCounts[entry.date][entry.emotion]) emotionCounts[entry.date][entry.emotion] = 0;
        emotionCounts[entry.date][entry.emotion]++;
      });
      // Prepare labels (dates) and datasets (emotions)
      const dates = Object.keys(emotionCounts).sort();
      const allEmotions = loadEmotions().map(e => e.name);
      const datasets = allEmotions.map(emotion => ({
        label: emotion,
        backgroundColor: getEmotionColor(emotion),
        data: dates.map(date => emotionCounts[date][emotion] || 0)
      }));
      return { dates, datasets };
    }

    // --- Render Bar Chart ---
    let emotionChart = null;
    function renderBarChart() {
      const ctx = document.getElementById('emotionBarChart').getContext('2d');
      const { dates, datasets } = getEmotionData();
      if (emotionChart) emotionChart.destroy();
      emotionChart = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: dates,
          datasets: datasets
        },
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Emotions Over Time' }
          },
          scales: {
            x: { stacked: true },
            y: { stacked: true, beginAtZero: true }
          }
        }
      });
    }

    // --- Render Entries List ---
    function renderEntries() {
      const emotions = JSON.parse(localStorage.getItem('emotions')) || [];
      const ul = document.getElementById('emotionList');
      ul.innerHTML = emotions.slice().reverse().map(e => 
        `<li><strong>${e.date}:</strong> <span style="color:${getEmotionColor(e.emotion)}">${e.emotion}</span></li>`
      ).join('');
    }

    // --- Initial Load ---
    window.onload = function() {
      renderEmotionWheel();
      renderEntries();
      renderBarChart();
    };
  </script>
</body>
</html>
